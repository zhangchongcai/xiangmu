webpackJsonpccm([23],{137:function(e,a,t){"use strict";function n(e){t(344)}Object.defineProperty(a,"__esModule",{value:!0});var i=t(282),o=t(346),s=t(3),l=n,r=s(i.a,o.a,!1,l,"data-v-078b0040",null);a.default=r.exports},282:function(e,a,t){"use strict";var n=t(30),i=t.n(n),o=t(57),s=t(61),l=t(32);t.n(l);a.a={components:{searchLan:o.a,cinemaTreeDialog:s.a},mixins:[l.cacheMixin.cacheMixin],data:function(){return{cacheField:["searchConfig","table","pageConfig"],modelName:"inventoryManagement",cinemaData:{type:2},sendIssueData:"",searchConfig:[{keyName:"batchCode",name:"票券批次号",type:"input",value:""},{keyName:"couponColor",name:"票纸颜色",type:"select",value:"",options:[{label:"全部",value:""},{label:"不设",value:"不设"},{label:"红色",value:"红色"},{label:"绿色",value:"绿色"},{label:"蓝色",value:"蓝色"},{label:"紫色",value:"紫色"},{label:"黄色",value:"黄色"},{label:"3D",value:"3D"}]},{name:"票券流水号范围",type:"input-more",inputNum:2,options:[{keyName:"startId",value:""},{keyName:"endId",value:""}]},{keyName:"couponCode",name:"票券编号",type:"input",value:""},{keyName:"stockStatus",name:"库存状态",type:"select",value:"",options:[{label:"全部",value:""},{label:"原票",value:"0"},{label:"配发",value:"1"},{label:"报损",value:"2"}]},{keyName:"queryCreateUserName",name:"操作人",type:"input",value:""}],table:{data:[],title:[{type:"selection",width:"55"},{prop:"id",label:"票券流水号",width:""},{prop:"couponCode",label:"票券编号",width:""},{prop:"couponColor",label:"票纸颜色",width:"100"},{prop:"allocateBusinessName",label:"配发影院",width:""},{prop:"stockStatus",label:"库存状态",width:"120",hasTemeplate:!0},{prop:"allocateTime",label:"操作日期",width:"",hasTemeplate:!0},{prop:"createUserName",label:"操作人"}]},pageConfig:{currentPage:1,pageSizes:[10,20,30,40],pageSize:10,total:15},searchParam:{},select:[]}},methods:{getRowKeys:function(e){return e.id},setSearch:function(e){this.searchParam=e},search:function(e,a,t){if(e&&this.$refs.iTable.clearSelection(),e){var n=/[^\-?\d.]/g;if(n.test(e.endId))return void this.$message({type:"warning",message:"票券流水号范围只能输入数字"});if(n.test(e.startId))return void this.$message({type:"warning",message:"票券流水号范围只能输入数字"})}var i=a||this;t||(i.searchParam=e,this.pageConfig.currentPage=1);var o=i.setParam(e);i.getData(o)},setParam:function(e){var a=this,t=!!e&&"{}"!=i()(e),n="{}"!=i()(a.searchParam);return{batchCode:t?e.batchCode:n?a.searchParam.batchCode:"",couponColor:t?e.couponColor:n?a.searchParam.couponColor:"",startId:t?e.startId:n?a.searchParam.startId:"",endId:t?e.endId:n?a.searchParam.endId:"",couponCode:t?e.couponCode:n?a.searchParam.couponCode:"",stockStatus:t?e.stockStatus:n?a.searchParam.stockStatus:"",queryCreateUserName:t?e.queryCreateUserName:n?a.searchParam.queryCreateUserName:"",pageNo:a.pageConfig.currentPage,pageSize:a.pageConfig.pageSize}},getData:function(e){var a=this;this.$ccmList.findCouponCodeList(e).then(function(e){var t=e.flag,n=e.msg,i="";i=3==t?"success":"warning","warning"==i&&a.$message({type:i,message:n}),"success"==i&&(a.table.data=e.data,a.pageConfig.total=e.pageNum)}).catch(function(e){console.log("查询报表错误,错误信息:"+e)})},issue:function(e){var a=this,t=!0,n=JSON.parse(i()(a.select)),o=JSON.parse(i()(a.searchParam)),s=!0,l=o.batchCode,r=!0,p=o.startId,c=o.endId,g=[];if(0==n.length)t=!1;else for(var u=0;u<n.length;u++){var d=!0,h="",m=n[u].stockStatus;if("issue"==e&&2==m)d=!1,h="报损的票券不能配发,请重新选择!";else if(!("debad"!=e&&"issue"!=e||1!=m&&2!=m)){d=!1;var f="issue"==e?"配发":"报损";h="只能"+f+"原票, 请重新选择"}if(!d)return a.$message({type:"warning",message:h});g.push(n[u].id)}if(""==l&&(s=!1),""!=p&&""!=c||(r=!1),t||s||r){var C={ids:g,batchCode:l,startId:p,endId:c,stockStatus:"issue"==e?1:2};a.$ccmList.validateCoupon(C).then(function(t){var n={ids:g,stockStatus:"issue"==e?1:2};3==t.flag?a.sendIssue(a,n):a.$message({type:"warning",message:t.msg})}).catch(function(e){console.log(e)})}else a.$message({type:"warning",message:"请勾选需配发的票券 或 填写票券批次号、票券流水号范围批量"+("issue"==e?"配发":"报损")})},sendIssue:function(e,a){var t=this;1==a.stockStatus?(this.$refs.cinemaTreeDialog.openDialog(!0),this.sendIssueData=a):this.$confirm("确认操作报损！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$ccmList.reimburseCoupon(a).then(function(a){var n="warning";if(5==a.flag&&(n="success"),e.$message({type:n,message:a.msg}),"success"==n){var i=e.setParam();e.getData(i),t.$refs.iTable.clearSelection()}}).catch(function(e){console.log(e)})})},scinemaCallBack:function(e){var a=this,t=this,n=this.sendIssueData;console.log(e),n.allocateBusinessId=e.id,n.allocateBusinessName=e.text,t.$ccmList.issueCoupon(n).then(function(e){var n="warning";if(5==e.flag&&(n="success"),t.$message({type:n,message:e.msg}),"success"==n){var i=t.setParam();t.getData(i),a.$refs.iTable.clearSelection()}}).catch(function(e){console.log(e)})},handleSelectionChange:function(e){console.log(e),this.select=e},handleSizeChange:function(e){this.pageConfig.pageSize=e,this.search(null,this,"backFirstpage")},handleCurrentChange:function(e){this.pageConfig.currentPage=e,this.search(null,this,"backFirstpage")}},created:function(){}}},344:function(e,a,t){var n=t(345);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);t(123)("24ee3a91",n,!0,{})},345:function(e,a,t){a=e.exports=t(122)(!0),a.push([e.i,"\n[data-v-078b0040].pageStyle .el-input .el-input__inner {\n  font-size: 12px !important;\n  height: 24px !important;\n  color: #666666;\n}\n[data-v-078b0040].pageStyle .el-pagination__sizes {\n  position: relative;\n  bottom: 1px;\n}\n[data-v-078b0040].pageStyle .el-pagination .el-pagination__jump {\n  margin: 0 24px;\n}\n[data-v-078b0040].pageStyle .el-pagination .el-pagination__total,[data-v-078b0040].pageStyle .el-pagination .btn-prev,[data-v-078b0040].pageStyle .el-pagination .el-pager li,[data-v-078b0040].pageStyle .el-pagination .btn-next,[data-v-078b0040].pageStyle .el-pagination .el-pagination__jump,[data-v-078b0040].pageStyle .el-pagination .el-pagination__sizes {\n  font-size: 12px !important;\n  height: 24px;\n  line-height: 24px;\n  min-width: 24px;\n  border-radius: 4px;\n  background: #ffffff;\n  color: #666666;\n}\n[data-v-078b0040].pageStyle .el-pagination .btn-prev,[data-v-078b0040].pageStyle .el-pagination .el-pager li,[data-v-078b0040].pageStyle .el-pagination .btn-next {\n  border: 1px solid #BCBCBC;\n}\nsection[data-v-078b0040] {\n  margin-bottom: 15px;\n}\n.addBtn[data-v-078b0040] {\n  width: 80px;\n  padding-left: 0;\n  padding-right: 0;\n  height: 32px;\n  font-size: 12px;\n  border-color: #3B74FF;\n  color: #3B74FF;\n}\n.autocollorr[data-v-078b0040] {\n  color: red;\n}\n","",{version:3,sources:["G:/Workspaces/work/chenxin/module-hyy/ccm/src/views/coupon/inventoryManagement/index.vue"],names:[],mappings:";AACA;EACE,2BAA2B;EAC3B,wBAAwB;EACxB,eAAe;CAChB;AACD;EACE,mBAAmB;EACnB,YAAY;CACb;AACD;EACE,eAAe;CAChB;AACD;EACE,2BAA2B;EAC3B,aAAa;EACb,kBAAkB;EAClB,gBAAgB;EAChB,mBAAmB;EACnB,oBAAoB;EACpB,eAAe;CAChB;AACD;EACE,0BAA0B;CAC3B;AACD;EACE,oBAAoB;CACrB;AACD;EACE,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,aAAa;EACb,gBAAgB;EAChB,sBAAsB;EACtB,eAAe;CAChB;AACD;EACE,WAAW;CACZ",file:"index.vue",sourcesContent:["\n[data-v-078b0040].pageStyle .el-input .el-input__inner {\n  font-size: 12px !important;\n  height: 24px !important;\n  color: #666666;\n}\n[data-v-078b0040].pageStyle .el-pagination__sizes {\n  position: relative;\n  bottom: 1px;\n}\n[data-v-078b0040].pageStyle .el-pagination .el-pagination__jump {\n  margin: 0 24px;\n}\n[data-v-078b0040].pageStyle .el-pagination .el-pagination__total,[data-v-078b0040].pageStyle .el-pagination .btn-prev,[data-v-078b0040].pageStyle .el-pagination .el-pager li,[data-v-078b0040].pageStyle .el-pagination .btn-next,[data-v-078b0040].pageStyle .el-pagination .el-pagination__jump,[data-v-078b0040].pageStyle .el-pagination .el-pagination__sizes {\n  font-size: 12px !important;\n  height: 24px;\n  line-height: 24px;\n  min-width: 24px;\n  border-radius: 4px;\n  background: #ffffff;\n  color: #666666;\n}\n[data-v-078b0040].pageStyle .el-pagination .btn-prev,[data-v-078b0040].pageStyle .el-pagination .el-pager li,[data-v-078b0040].pageStyle .el-pagination .btn-next {\n  border: 1px solid #BCBCBC;\n}\nsection[data-v-078b0040] {\n  margin-bottom: 15px;\n}\n.addBtn[data-v-078b0040] {\n  width: 80px;\n  padding-left: 0;\n  padding-right: 0;\n  height: 32px;\n  font-size: 12px;\n  border-color: #3B74FF;\n  color: #3B74FF;\n}\n.autocollorr[data-v-078b0040] {\n  color: red;\n}\n"],sourceRoot:""}])},346:function(e,a,t){"use strict";var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"table-page"},[t("section",{staticClass:"search-section"},[t("search-lan",{attrs:{config:e.searchConfig,modelName:e.modelName},on:{pressSearch:e.search,searchValueChange:e.setSearch}})],1),e._v(" "),t("section",{staticClass:"btnGroup-section flex-base flex-end"},[t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){return e.issue("issue")}}},[e._v("配发")]),e._v(" "),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(a){return e.issue("debad")}}},[e._v("报损")])],1),e._v(" "),t("section",{staticClass:"table-section"},[t("el-table",{ref:"iTable",staticStyle:{width:"100%"},attrs:{data:e.table.data,"tooltip-effect":"dark","row-key":e.getRowKeys},on:{"selection-change":e.handleSelectionChange}},[e._l(e.table.title,function(a,n){return[a.type?t("el-table-column",{key:n,attrs:{type:a.type,width:a.width,"reserve-selection":!0}}):a.type||a.hasTemeplate?!a.type&&a.hasTemeplate?t("el-table-column",{key:n,attrs:{prop:a.prop,label:a.label,width:a.width,fixed:a.fiexd,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(n){return["stockStatus"==a.prop?t("div",[e._v("\n              "+e._s(n.row.stockStatus?2==n.row.stockStatus?"报损":"配发":"原票")+"\n            ")]):"allocateTime"==a.prop?t("div",[n.row.allocateTime?t("span",[e._v(e._s(e._f("formatDate")(n.row.allocateTime,"yyyy-MM-dd")))]):t("span")]):e._e()]}}],null,!0)}):e._e():t("el-table-column",{key:n,attrs:{prop:a.prop,label:a.label,width:a.width,"show-overflow-tooltip":""}})]})],2)],1),e._v(" "),0!=e.table.data.length?t("section",{staticClass:"pagination-section flex-base flex-center pageStyle"},[t("el-pagination",{attrs:{"current-page":e.pageConfig.currentPage,"page-sizes":e.pageConfig.pageSizes,"page-size":e.pageConfig.pageSize,background:"",layout:"total, prev, pager, next, jumper, sizes",total:e.pageConfig.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(a){return e.$set(e.pageConfig,"currentPage",a)},"update:current-page":function(a){return e.$set(e.pageConfig,"currentPage",a)}}})],1):e._e(),e._v(" "),t("cinemaTreeDialog",{ref:"cinemaTreeDialog",attrs:{innerData:e.cinemaData},on:{cinemaCallBack:e.scinemaCallBack}})],1)},i=[],o={render:n,staticRenderFns:i};a.a=o}});