webpackJsonpcrm([23],{141:function(e,t,a){"use strict";function s(e){a(279)}Object.defineProperty(t,"__esModule",{value:!0});var n=a(201),l=a(281),o=a(8),r=s,i=o(n.a,l.a,!1,r,null,null);t.default=i.exports},173:function(e,t,a){"use strict";function s(e){return e||0==e?e.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>").replace(/\s/g,"&nbsp;"):"-"}t.a=s},201:function(e,t,a){"use strict";var s=a(53),n=a.n(s),l=a(173);t.a={name:"CardList",data:function(){return{sendAgainMsg:[],viewMsgDialog:!1,viewMsgContent:"",tipMessage:"",total:0,formData:{date:[],labelName:"",mobileNum:"",memberId:"",memberName:"",messageBatchNo:"",status:"",startTime:"",endTime:"",current:1,size:20,tenantId:this.$store.state.loginUser.consumerId},tableData:[],MsgStatusOptions:[{code:"",desc:"全部"},{code:"success",desc:"发送成功"},{code:"fail",desc:"发送失败"}]}},mounted:function(){this.search()},filters:{formatFailReason:function(e){return null==e||""==e?"-":"messageTimeSpanError"==e?"短信时间间隔内":"systemError"==e?"系统问题":void 0},judegStatus:function(e){return"success"==e?"发送成功":"fail"==e?"发送失败":"-"},formatCreateTime:function(e){return e?new Date(e.replace(/-/g,"/")).formatDate("yyyy-MM-dd hh:mm:ss"):"-"}},methods:{search:function(){var e=this,t=JSON.parse(n()(this.formData));this.$delete(t,"date"),this.formData.date&&2==this.formData.date.length&&(t.startTime=this.formData.date[0],t.endTime=this.formData.date[1]),this.tipMessage="数据加载中...",this.$crmList.labelMessageListPage(t).then(function(t){0==t.total&&(e.tipMessage="暂无数据"),e.tableData=t.records,e.total=t.total}).catch(function(t){t&&t.msg?e.tipMessage=t.msg:e.tipMessage="系统繁忙，请稍后重试！"})},handleSearch:function(){this.formData.current=1,this.search()},resetForm:function(e){this.$refs[e].resetFields()},handleSizeChange:function(e){this.formData.size=e,this.search()},handleCurrentChange:function(e){this.formData.current=e,this.search()},selectable:function(e,t){return"success"!=e.status&&(("fail"!=e.status||"messageTimeSpanError"!=e.failReason)&&("fail"==e.status&&"systemError"==e.failReason||void 0))},handleSelectMsg:function(e){this.sendAgainMsg=e},handleViewMsgContent:function(e){this.viewMsgDialog=!0,this.viewMsgContent=e.content},handleResendMsg:function(){var e=this;if(0==this.sendAgainMsg.length)return this.$message.warning("请选择要重新发送的短信"),!1;var t={labelMessageDetailVOList:this.sendAgainMsg};this.$crmList.resendLabelMessageList(t).then(function(t){t&&(e.$refs.msgDetailTable.clearSelection(),e.search(),e.$message.success("操作成功,请稍后查看短信发送结果"))}).catch(function(t){e.$message.error("操作失败，请重试"),console.log(t)})},handleExportExcel:function(){var e=this.$store.state.default.apiConfig.baseURL+this.$store.state.crm.domain+"/label/export?tenantId="+this.$store.state.loginUser.consumerId+"&labelName="+this.formData.labelName+"&memberId="+this.formData.memberId+"&memberName="+this.formData.memberName+"&messageBatchNo="+this.formData.messageBatchNo+"&mobileNum="+this.formData.mobileNum+"&status="+this.formData.status+"&startTime="+(2==this.formData.date.length?this.formData.date[0]:"")+"&endTime="+(2==this.formData.date.length?this.formData.date[1]:"")+"&token="+this.$store.state.loginToken;window.open(e,"_blank")},formatRemark:function(e){return Object(l.a)(e)},formateEmpty:function(e,t,a,s){return null==a||void 0==a||""===a?"-":a},getRowKeys:function(e){return e.id}}}},279:function(e,t,a){var s=a(280);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a(132)("a2ab33b6",s,!0,{})},280:function(e,t,a){t=e.exports=a(131)(!0),t.push([e.i,"\n.member-list ._resend-msg {\n  font-size: 12px;\n  padding: 6px 0;\n  text-align: right;\n}\n.member-list ._resend-msg .add-button-custom {\n    font-size: 12px;\n    padding: 8px 10px;\n}\n.member-list ._msg-detail-list-table table thead tr th:first-child .cell {\n  padding-left: 10px !important;\n}\n.member-list ._msg-detail-list-table table tbody tr td:first-child .cell {\n  padding-left: 10px !important;\n}\n.member-list ._msg-detail-list-table .circle {\n  display: inline-block;\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  margin-right: 2px;\n}\n.member-list ._msg-detail-list-table .system-reason {\n  background: #739bff;\n}\n.member-list ._msg-detail-list-table .send-frequent {\n  background: #f33430;\n}\n.member-list ._msg-detail-list-table .success {\n  color: #2dbc2d;\n}\n.member-list ._msg-detail-list-table .fail {\n  color: #f33430;\n}\n.member-list ._msg-detail-list-table .operation-button span {\n  font-size: 12px;\n}\n.__view-msg-dialog .el-dialog__header {\n  padding: 10px 20px;\n}\n.__view-msg-dialog .el-dialog__body {\n  padding: 0px 20px;\n  position: relative;\n}\n.__view-msg-dialog .el-dialog__footer {\n  text-align: center;\n}\n.__view-msg-dialog .el-dialog__headerbtn {\n  top: 13px;\n}\n.__view-msg-dialog ._view-msg-content-wrap {\n  margin-top: 20px;\n  padding: 0 50px;\n  min-height: 194px;\n}\n","",{version:3,sources:["G:/Workspaces/work/chenxin/module-hyy/crm/src/views/member/memberTags/msgDetailList.vue"],names:[],mappings:";AACA;EACE,gBAAgB;EAChB,eAAe;EACf,kBAAkB;CACnB;AACD;IACI,gBAAgB;IAChB,kBAAkB;CACrB;AACD;EACE,8BAA8B;CAC/B;AACD;EACE,8BAA8B;CAC/B;AACD;EACE,sBAAsB;EACtB,WAAW;EACX,YAAY;EACZ,mBAAmB;EACnB,kBAAkB;CACnB;AACD;EACE,oBAAoB;CACrB;AACD;EACE,oBAAoB;CACrB;AACD;EACE,eAAe;CAChB;AACD;EACE,eAAe;CAChB;AACD;EACE,gBAAgB;CACjB;AACD;EACE,mBAAmB;CACpB;AACD;EACE,kBAAkB;EAClB,mBAAmB;CACpB;AACD;EACE,mBAAmB;CACpB;AACD;EACE,UAAU;CACX;AACD;EACE,iBAAiB;EACjB,gBAAgB;EAChB,kBAAkB;CACnB",file:"msgDetailList.vue",sourcesContent:["\n.member-list ._resend-msg {\n  font-size: 12px;\n  padding: 6px 0;\n  text-align: right;\n}\n.member-list ._resend-msg .add-button-custom {\n    font-size: 12px;\n    padding: 8px 10px;\n}\n.member-list ._msg-detail-list-table table thead tr th:first-child .cell {\n  padding-left: 10px !important;\n}\n.member-list ._msg-detail-list-table table tbody tr td:first-child .cell {\n  padding-left: 10px !important;\n}\n.member-list ._msg-detail-list-table .circle {\n  display: inline-block;\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  margin-right: 2px;\n}\n.member-list ._msg-detail-list-table .system-reason {\n  background: #739bff;\n}\n.member-list ._msg-detail-list-table .send-frequent {\n  background: #f33430;\n}\n.member-list ._msg-detail-list-table .success {\n  color: #2dbc2d;\n}\n.member-list ._msg-detail-list-table .fail {\n  color: #f33430;\n}\n.member-list ._msg-detail-list-table .operation-button span {\n  font-size: 12px;\n}\n.__view-msg-dialog .el-dialog__header {\n  padding: 10px 20px;\n}\n.__view-msg-dialog .el-dialog__body {\n  padding: 0px 20px;\n  position: relative;\n}\n.__view-msg-dialog .el-dialog__footer {\n  text-align: center;\n}\n.__view-msg-dialog .el-dialog__headerbtn {\n  top: 13px;\n}\n.__view-msg-dialog ._view-msg-content-wrap {\n  margin-top: 20px;\n  padding: 0 50px;\n  min-height: 194px;\n}\n"],sourceRoot:""}])},281:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"member-list"},[a("el-form",{ref:"formData",staticClass:"form-data-wrap _member-search-area-custom",attrs:{inline:!0,model:e.formData}},[a("el-form-item",{attrs:{label:"标签名称：",prop:"labelName"}},[a("el-input",{attrs:{placeholder:"填写标签名称",clearable:""},on:{blur:function(){e.formData.labelName=e.formData.labelName.trim()}},model:{value:e.formData.labelName,callback:function(t){e.$set(e.formData,"labelName",t)},expression:"formData.labelName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号：",prop:"mobileNum"}},[a("el-input",{attrs:{placeholder:"填写手机号",clearable:""},on:{blur:function(){e.formData.mobileNum=e.formData.mobileNum.trim()}},model:{value:e.formData.mobileNum,callback:function(t){e.$set(e.formData,"mobileNum",t)},expression:"formData.mobileNum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"会员ID：",prop:"memberId"}},[a("el-input",{attrs:{placeholder:"填写会员ID",clearable:""},on:{blur:function(){e.formData.memberId=e.formData.memberId.trim()}},model:{value:e.formData.memberId,callback:function(t){e.$set(e.formData,"memberId",t)},expression:"formData.memberId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"会员姓名：",prop:"memberName"}},[a("el-input",{attrs:{placeholder:"填写会员姓名",clearable:""},on:{blur:function(){e.formData.memberName=e.formData.memberName.trim()}},model:{value:e.formData.memberName,callback:function(t){e.$set(e.formData,"memberName",t)},expression:"formData.memberName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"短信批次号：",prop:"messageBatchNo"}},[a("el-input",{attrs:{placeholder:"短信批次号",clearable:""},on:{blur:function(){e.formData.messageBatchNo=e.formData.messageBatchNo.trim()}},model:{value:e.formData.messageBatchNo,callback:function(t){e.$set(e.formData,"messageBatchNo",t)},expression:"formData.messageBatchNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"发送状态：",prop:"status"}},[a("el-select",{attrs:{placeholder:"全部状态",clearable:""},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},e._l(e.MsgStatusOptions,function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"发送时间：",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.formData.date,callback:function(t){e.$set(e.formData,"date",t)},expression:"formData.date"}})],1),e._v(" "),a("el-form-item",{staticClass:"btn-wrap"},[a("el-button",{staticClass:"_el-btn-custom",attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v(" "),a("el-button",{staticClass:"_el-btn-custom _member-custom-ghost-button",attrs:{plain:""},on:{click:function(t){return e.resetForm("formData")}}},[e._v("重置\n      ")])],1)],1),e._v(" "),a("div",{staticClass:"_resend-msg"},[a("el-button",{staticClass:"add-button-custom _member-custom-ghost-button",attrs:{plain:""},on:{click:e.handleResendMsg}},[e._v("重新发送短信")]),e._v(" "),a("el-button",{staticClass:"add-button-custom _member-custom-ghost-button",attrs:{plain:""},on:{click:e.handleExportExcel}},[e._v("导出Excel\n    ")])],1),e._v(" "),a("div",{staticClass:"_msg-detail-list-table _m-member-table-custom"},[a("el-table",{ref:"msgDetailTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","empty-text":e.tipMessage,"row-key":e.getRowKeys},on:{"selection-change":e.handleSelectMsg}},[a("el-table-column",{attrs:{type:"selection",selectable:e.selectable,width:"40","reserve-selection":!0,align:"center"}}),e._v(" "),a("el-table-column",{attrs:{type:"index",prop:"id",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(t.$index+(e.formData.current-1)*e.formData.size+1))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"labelName",label:"标签名称","min-width":"130",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"messageBatchNo",label:"短信批次号","min-width":"115",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobileNum",label:"手机号","min-width":"95",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"sendTime",label:"发送时间","min-width":"140","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatCreateTime")(t.row.sendTime)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"memberId",label:"会员ID","min-width":"120",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"memberName",label:"会员姓名","min-width":"90",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"发送状态","min-width":"90","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:"success"==t.row.status?"success":"fail",staticStyle:{fontSize:"12px"}},[e._v(e._s(e._f("judegStatus")(t.row.status)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"failReason",label:"失败原因","min-width":"120",formatter:e.formateEmpty,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=t.row.failReason&&""!=t.row.failReason?a("span",{staticClass:"circle",class:"systemError"==t.row.failReason?"system-reason":"messageTimeSpanError"==t.row.failReason?"send-frequent":""}):e._e(),e._v("\n          "+e._s(e._f("formatFailReason")(t.row.failReason))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"operation-button",attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleViewMsgContent(t.row)}}},[e._v("查看短信内容\n          ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"page-wrap"},[a("el-pagination",{attrs:{background:"","current-page":e.formData.current-0,"page-size":e.formData.size-0,layout:"total, sizes, prev, pager, next, jumper","page-sizes":[20,50,100],total:e.total-0},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{staticClass:"__view-msg-dialog",attrs:{title:"短信内容",visible:e.viewMsgDialog,width:"448px"},on:{"update:visible":function(t){e.viewMsgDialog=t}}},[a("div",{staticClass:"_view-msg-content-wrap"},[a("span",{staticStyle:{"font-size":"12px"},domProps:{innerHTML:e._s(e.formatRemark(e.viewMsgContent))}})]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"_el-btn-custom",attrs:{size:"medium"},on:{click:function(t){e.viewMsgDialog=!1}}},[e._v("关闭")])],1)])],1)},n=[],l={render:s,staticRenderFns:n};t.a=l}});