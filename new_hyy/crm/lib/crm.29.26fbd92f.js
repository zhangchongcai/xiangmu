webpackJsonpcrm([29],{161:function(e,t,a){"use strict";function n(e){a(392)}Object.defineProperty(t,"__esModule",{value:!0});var i=a(233),r=a(394),o=a(8),l=n,s=o(i.a,r.a,!1,l,null,null);t.default=s.exports},233:function(e,t,a){"use strict";var n=a(53),i=a.n(n),r=requireModule("base"),o=r.singleCinema;t.a={name:"ReceiveEntityCard",data:function(){return{cinemaInfoVisible:!1,cinemaInfoList:[],applyArr:[],flag:"",cardBatchCinemaVO:{},cinemaDialogVisible:!1,whereUse:"1",tipMessage:"",formData:{cardBatchName:"",date:[(new Date).addMonths(-1).formatDate("yyyy-MM-dd"),(new Date).formatDate("yyyy-MM-dd")],cardBatchNo:"",cardProductId:"",cardType:"gift_card",receiveCinemaName:""},cardNameOptions:[],current:1,pageSize:20,total:0,tableDataList:[],startOpenDate:(new Date).addDays(0).formatDate("yyyy-MM-dd hh:mm:ss"),cardTypeOptions:[],cardCurrent:1,cardPageSize:1e3}},components:{singleCinema:o},created:function(){this.handleCardType(),this.getCardbatchList(),this.getCardproductList()},methods:{handleCinemaCallBack:function(e){var t=this;if(e.isCloseWindow)return this.cinemaDialogVisible=!1,!1;if("{}"!=i()(e.data)){var a=function(){var t=this;this.cardBatchCinemaVO={cinemaCode:e.data.code,cinemaId:e.data.id,cinemaName:e.data.name};var a=this.applyArr.map(function(e){return e.cardBatchCinemaVO=t.cardBatchCinemaVO,e}),n={receiveCardBatchVOList:a};this.$crmList.receiveBtach(n).then(function(){t.getCardbatchList(),t.$message.success(("apply"==t.flag?"领用":"退还")+"成功"),t.cinemaDialogVisible=!1}).catch(function(e){console.log(e)})};"return"==this.flag?this.applyArr.forEach(function(n){if(!(JSON.parse(i()(n.cardBatchCinemaVOList)).map(function(e){return e.cinemaId}).indexOf(e.data.id+"")>-1))return t.$message.warning("该影院未领取当前批次礼品卡，请选择其他影院"),!1;a.call(t)}):a.call(this)}else this.cinemaDialogVisible=!0,this.$message.warning("请选择"+("apply"==this.flag?"领用":"退还")+"影院")},formateEmpty:function(e,t,a,n){return null==a||void 0==a||""===a?"-":a},handleCardType:function(){var e={tenantId:this.$store.state.loginUser.consumerId},t=this;t.$crmList.getCardType(e).then(function(e){t.cardTypeOptions=e})},getCardbatchList:function(){var e=this,t=this;if(null==t.formData.date)return t.$message.warning("请选择创建时间"),!1;t.tipMessage="数据加载中...";var a={current:t.current,size:t.pageSize,tenantId:t.$store.state.loginUser.consumerId,cardBatchName:t.formData.cardBatchName,startTime:t.formData.date[0],endTime:t.formData.date[1],cardBatchNo:t.formData.cardBatchNo,cardProductId:t.formData.cardProductId,cardProductType:t.formData.cardType,receiveCinemaName:t.formData.receiveCinemaName};t.$crmList.receiveList(a).then(function(e){0!=e.total&&null!=e.data||(t.tipMessage="暂无数据");for(var a=0;a<e.records.length;a++)e.records[a].cinemaNeedReceiveCount=void 0,e.records[a].cinemaNeedReturnCount=void 0;t.tableDataList=e.records,t.current=e.current,t.pageSize=e.size,t.total=e.total}).catch(function(t){console.log(t),t&&t.msg?e.tipMessage=t.msg:e.tipMessage="系统繁忙，请稍后重试！"})},getCardproductList:function(){var e=this,t={cardType:"gift_card",current:e.cardCurrent,size:e.cardPageSize,tenantId:this.$store.state.loginUser.consumerId,status:"start"};e.$crmList.cardproductList(t).then(function(t){e.cardNameOptions=t.records})},search:function(){this.current=1,this.getCardbatchList()},resetForm:function(e){this.$refs[e].resetFields()},handleApplyCard:function(e,t){var a=this;if(this.flag=e,this.applyArr=[],this.tableDataList.map(function(e){"apply"==a.flag?e.cinemaNeedReceiveCount&&(e.cinemaNeedReturnCount=void 0,a.applyArr.push(e)):e.cinemaNeedReturnCount&&t==e.id&&(e.cinemaNeedReceiveCount=void 0,a.applyArr.push(e))}),0==this.applyArr.length)return this.$message.warning("请填写"+("apply"==this.flag?"领用":"退还")+"数量"),!1;if("return"==this.flag){if(null==this.applyArr[0].cardBatchCinemaVOList)return this.$message.warning("没有领用影院，无法退还"),!1;this.cinemaDialogVisible=!0}else this.cinemaDialogVisible=!0},handleDownload:function(e){var t=this.$store.state.default.apiConfig.baseURL+this.$store.state.crm.domain+"/cardbatch/exportReceiveCard?cardBatchId="+e+"&tenantId="+this.$store.state.loginUser.consumerId+"&token="+this.$store.state.loginToken;window.open(t,"_blank")},handleQueryCinema:function(e){this.cinemaInfoVisible=!0,this.cinemaInfoList=e||[]},handleSizeChange:function(e){var t=this;t.pageSize=e,t.getCardbatchList()},handleCurrentChange:function(e){var t=this;t.current=e,t.getCardbatchList()},handleCardbatchDetail:function(e){this.$router.push({path:"/member/membershipCard/cardBatchDetail"}),sessionStorage.setItem("crmCardBatchInfo",i()(e))}}}},392:function(e,t,a){var n=a(393);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a(132)("43a5019c",n,!0,{})},393:function(e,t,a){t=e.exports=a(131)(!0),t.push([e.i,"\n.entity-card-list .head-info-wrap {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 44px;\n  line-height: 2;\n}\n.entity-card-list .head-info-wrap .data-title {\n    font-size: 12px;\n    color: #b1b1b1;\n    padding: 8px 0;\n}\n.entity-card-list .entity-card-list-table .used-num,\n.entity-card-list .entity-card-list-table .return-num {\n  width: 80px;\n  font-size: 12px;\n  color: #333;\n}\n.entity-card-list .entity-card-list-table .used-num .el-input__inner,\n  .entity-card-list .entity-card-list-table .return-num .el-input__inner {\n    height: 20px;\n    line-height: 20px;\n}\n.entity-card-list .entity-card-list-table .download-btn span,\n.entity-card-list .entity-card-list-table .change-btn span {\n  font-size: 12px;\n}\n.entity-card-list .noData {\n  margin: 15% auto;\n  text-align: center;\n  font-family: MicrosoftYaHei;\n  font-size: 16px;\n  color: #bcbcbc;\n  letter-spacing: 0.19px;\n}\n.entity-card-list .noData p {\n    margin-top: 30px;\n}\n._mbmber-used-cinema-info-visible .el-dialog__header {\n  padding: 10px 20px;\n}\n._mbmber-used-cinema-info-visible .el-dialog__body {\n  padding: 0px 20px;\n}\n._mbmber-used-cinema-info-visible .el-dialog__footer {\n  text-align: center;\n}\n._mbmber-used-cinema-info-visible .__table-wrap {\n  border-top: 1px solid #f5f5f5;\n  padding-top: 10px;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-form-item {\n    margin: 0 5px 5px 0;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .heightBug input {\n    height: 32px !important;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-table__body-wrapper {\n    overflow-y: auto;\n    height: 417px;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-table__body-wrapper .el-table__body {\n      border-collapse: collapse;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-table__body-wrapper .el-table__body tbody tr:last-child {\n        border-bottom: 1px solid #f0f0f0;\n}\n","",{version:3,sources:["G:/Workspaces/work/chenxin/module-hyy/crm/src/views/member/membershipCardInfo/receiveEntityCard.vue"],names:[],mappings:";AACA;EACE,qBAAqB;EACrB,qBAAqB;EACrB,cAAc;EACd,0BAA0B;MACtB,uBAAuB;UACnB,+BAA+B;EACvC,0BAA0B;MACtB,uBAAuB;UACnB,oBAAoB;EAC5B,aAAa;EACb,eAAe;CAChB;AACD;IACI,gBAAgB;IAChB,eAAe;IACf,eAAe;CAClB;AACD;;EAEE,YAAY;EACZ,gBAAgB;EAChB,YAAY;CACb;AACD;;IAEI,aAAa;IACb,kBAAkB;CACrB;AACD;;EAEE,gBAAgB;CACjB;AACD;EACE,iBAAiB;EACjB,mBAAmB;EACnB,4BAA4B;EAC5B,gBAAgB;EAChB,eAAe;EACf,uBAAuB;CACxB;AACD;IACI,iBAAiB;CACpB;AACD;EACE,mBAAmB;CACpB;AACD;EACE,kBAAkB;CACnB;AACD;EACE,mBAAmB;CACpB;AACD;EACE,8BAA8B;EAC9B,kBAAkB;CACnB;AACD;IACI,oBAAoB;CACvB;AACD;IACI,wBAAwB;CAC3B;AACD;IACI,iBAAiB;IACjB,cAAc;CACjB;AACD;MACM,0BAA0B;CAC/B;AACD;QACQ,iCAAiC;CACxC",file:"receiveEntityCard.vue",sourcesContent:["\n.entity-card-list .head-info-wrap {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 44px;\n  line-height: 2;\n}\n.entity-card-list .head-info-wrap .data-title {\n    font-size: 12px;\n    color: #b1b1b1;\n    padding: 8px 0;\n}\n.entity-card-list .entity-card-list-table .used-num,\n.entity-card-list .entity-card-list-table .return-num {\n  width: 80px;\n  font-size: 12px;\n  color: #333;\n}\n.entity-card-list .entity-card-list-table .used-num .el-input__inner,\n  .entity-card-list .entity-card-list-table .return-num .el-input__inner {\n    height: 20px;\n    line-height: 20px;\n}\n.entity-card-list .entity-card-list-table .download-btn span,\n.entity-card-list .entity-card-list-table .change-btn span {\n  font-size: 12px;\n}\n.entity-card-list .noData {\n  margin: 15% auto;\n  text-align: center;\n  font-family: MicrosoftYaHei;\n  font-size: 16px;\n  color: #bcbcbc;\n  letter-spacing: 0.19px;\n}\n.entity-card-list .noData p {\n    margin-top: 30px;\n}\n._mbmber-used-cinema-info-visible .el-dialog__header {\n  padding: 10px 20px;\n}\n._mbmber-used-cinema-info-visible .el-dialog__body {\n  padding: 0px 20px;\n}\n._mbmber-used-cinema-info-visible .el-dialog__footer {\n  text-align: center;\n}\n._mbmber-used-cinema-info-visible .__table-wrap {\n  border-top: 1px solid #f5f5f5;\n  padding-top: 10px;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-form-item {\n    margin: 0 5px 5px 0;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .heightBug input {\n    height: 32px !important;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-table__body-wrapper {\n    overflow-y: auto;\n    height: 417px;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-table__body-wrapper .el-table__body {\n      border-collapse: collapse;\n}\n._mbmber-used-cinema-info-visible .__table-wrap .el-table__body-wrapper .el-table__body tbody tr:last-child {\n        border-bottom: 1px solid #f0f0f0;\n}\n"],sourceRoot:""}])},394:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"entity-card-list"},[a("el-form",{ref:"formData",staticClass:"form-data-wrap _member-search-area-custom",attrs:{inline:!0,model:e.formData}},[a("el-form-item",{attrs:{label:"批次号：",prop:"cardBatchNo"}},[a("el-input",{attrs:{placeholder:"请输入卡批次编号",clearable:""},on:{blur:function(){e.formData.cardBatchNo=e.formData.cardBatchNo.trim()}},model:{value:e.formData.cardBatchNo,callback:function(t){e.$set(e.formData,"cardBatchNo",t)},expression:"formData.cardBatchNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"批次名称：",prop:"cardBatchName"}},[a("el-input",{attrs:{placeholder:"请输入卡批次名称",clearable:""},on:{blur:function(){e.formData.cardBatchName=e.formData.cardBatchName.trim()}},model:{value:e.formData.cardBatchName,callback:function(t){e.$set(e.formData,"cardBatchName",t)},expression:"formData.cardBatchName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"政策名称：",prop:"cardProductId"}},[a("el-select",{attrs:{placeholder:"请选择卡政策",filterable:"",clearable:""},model:{value:e.formData.cardProductId,callback:function(t){e.$set(e.formData,"cardProductId",t)},expression:"formData.cardProductId"}},e._l(e.cardNameOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.cardName,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"卡类型：",prop:"cardType"}},[a("el-select",{attrs:{placeholder:"全部类型",clearable:"",disabled:""},model:{value:e.formData.cardType,callback:function(t){e.$set(e.formData,"cardType",t)},expression:"formData.cardType"}},e._l(e.cardTypeOptions,function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间：",prop:"date"}},[a("el-date-picker",{staticStyle:{width:"256px"},attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.formData.date,callback:function(t){e.$set(e.formData,"date",t)},expression:"formData.date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"领用影院：",prop:"receiveCinemaName"}},[a("el-input",{attrs:{placeholder:"请输入影院名称",clearable:""},on:{blur:function(){e.formData.receiveCinemaName=e.formData.receiveCinemaName.trim()}},model:{value:e.formData.receiveCinemaName,callback:function(t){e.$set(e.formData,"receiveCinemaName",t)},expression:"formData.receiveCinemaName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticClass:"_el-btn-custom",attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("el-button",{staticClass:"_el-btn-custom _member-custom-ghost-button",attrs:{plain:""},on:{click:function(t){return e.resetForm("formData")}}},[e._v("重置\n      ")])],1)],1),e._v(" "),a("div",{staticClass:"head-info-wrap"},[a("div",{staticClass:"data-title"},[e._v("数据更新于 "+e._s(e.startOpenDate))]),e._v(" "),a("div",[a("el-button",{staticClass:"_el-btn-custom _member-custom-ghost-button",attrs:{size:"small",plain:""},on:{click:function(t){return e.handleApplyCard("apply")}}},[e._v("\n        领用\n      ")])],1)]),e._v(" "),a("div",{staticClass:"entity-card-list-table _m-member-table-custom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataList,stripe:"","empty-text":e.tipMessage}},[a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"135",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"batchNo",label:"批次号","min-width":"105",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"batchName",label:"批次名称","min-width":"95",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardProductName",label:"政策名称","min-width":"95",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardValue",label:"金额","min-width":"65",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"batchCount",label:"总张数","min-width":"65",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"cinemaReceiveCount",label:"已领用","min-width":"65",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"cinemaNoReceiveCount",label:"未领用","min-width":"65",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"cardBatchCinemaVOList",label:"领用影院","min-width":"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.cardBatchCinemaVOList?t.row.cardBatchCinemaVOList&&1==t.row.cardBatchCinemaVOList.length?a("span",[e._v(e._s(t.row.cardBatchCinemaVOList[0].cinemaName))]):a("span",{staticStyle:{color:"#3b74ff",cursor:"pointer"},on:{click:function(a){return e.handleQueryCinema(t.row.cardBatchCinemaVOList)}}},[e._v("查看")]):a("span",[e._v("-")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"cinemaNeedReceiveCount",label:"领用数量","min-width":"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{staticClass:"used-num",attrs:{step:1,"step-strictly":"",controls:!1,min:1,max:t.row.cinemaNoReceiveCount},model:{value:t.row.cinemaNeedReceiveCount,callback:function(a){e.$set(t.row,"cinemaNeedReceiveCount",a)},expression:"scope.row.cinemaNeedReceiveCount"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"cinemaNeedReturnCount",label:"退还数量","min-width":"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{staticClass:"return-num",attrs:{step:1,"step-strictly":"",controls:!1,min:1,max:t.row.cinemaReceiveCount},model:{value:t.row.cinemaNeedReturnCount,callback:function(a){e.$set(t.row,"cinemaNeedReturnCount",a)},expression:"scope.row.cinemaNeedReturnCount"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"download-btn",attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleCardbatchDetail(t.row)}}},[e._v("查看\n          ")]),e._v(" "),a("el-button",{staticClass:"download-btn",attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleApplyCard("return",t.row.id)}}},[e._v("退还\n          ")]),e._v(" "),a("el-button",{staticClass:"download-btn",attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleDownload(t.row.id)}}},[e._v("下载Excel\n          ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"page-wrap"},[a("el-pagination",{attrs:{background:"","current-page":e.current-0,"page-sizes":[20,50,100],"page-size":e.pageSize-0,layout:"total, sizes, prev, pager, next, jumper",total:e.total-0},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("singleCinema",{ref:"frameSingleCinema",attrs:{framedialogVisible:e.cinemaDialogVisible,type:"2",whereUse:e.whereUse,innerData:{},dialogTitle:"apply"==this.flag?"选择领用影院":"选择退还影院"},on:{"update:framedialogVisible":function(t){e.cinemaDialogVisible=t},"update:framedialog-visible":function(t){e.cinemaDialogVisible=t},callBackSingle:e.handleCinemaCallBack}},[a("div",{attrs:{slot:"footerId"},slot:"footerId"},[a("el-button",{on:{click:function(t){e.cinemaDialogVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$refs.frameSingleCinema.confirmData()}}},[e._v("确定\n      ")])],1)]),e._v(" "),a("el-dialog",{staticClass:"_mbmber-used-cinema-info-visible",attrs:{title:"领用影院信息",visible:e.cinemaInfoVisible,width:"576px"},on:{"update:visible":function(t){e.cinemaInfoVisible=t}}},[a("div",{staticClass:"__table-wrap"},[a("div",{staticClass:"_m-member-table-custom"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.cinemaInfoList,stripe:"","empty-text":"暂无领用影院信息"}},[a("el-table-column",{attrs:{prop:"cinemaName",label:"领用影院","min-width":"110",formatter:e.formateEmpty,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"cinemaReceiveCount",label:"张数","min-width":"110",formatter:e.formateEmpty,"show-overflow-tooltip":""}})],1)],1)]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"_el-btn-custom",attrs:{size:"medium"},on:{click:function(t){e.cinemaInfoVisible=!1}}},[e._v("关闭")])],1)])],1)},i=[],r={render:n,staticRenderFns:i};t.a=r}});