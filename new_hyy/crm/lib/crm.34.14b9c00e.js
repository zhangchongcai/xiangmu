webpackJsonpcrm([34],{160:function(r,e,a){"use strict";function t(r){a(389)}Object.defineProperty(e,"__esModule",{value:!0});var n=a(232),o=a(391),d=a(8),l=t,c=d(n.a,o.a,!1,l,null,null);e.default=c.exports},232:function(r,e,a){"use strict";e.a={name:"addEntityCard",data:function(){return{ruleForm:{cardWay:1,cardType:"stored_card",cardProductId:"",name:"",cardNumberRule:"0",passwordRule:1,password:"",numberOfSheets:""},rules:{name:[{required:!0,message:"请输入卡批次名称",trigger:"blur"}],cardWay:[{required:!0,message:"请选择开卡方式",trigger:"change"}],cardType:[{required:!0,message:"请选择卡类型",trigger:"change"}],cardProductId:[{required:!0,message:"请选择适用政策",trigger:"change"}],cardNumberRule:[{required:!0,message:"请选择卡号生成规则",trigger:"change"}],passwordRule:[{required:!0,message:" ",trigger:"change"}],password:[{required:!0,validator:function(r,e,a){""==e.toString().replace(/\s/g,"")&&a(new Error("请输入数字")),/^[0-9]\d*$/.test(e.toString().replace(/\s/g,""))||a(new Error("请输入非负整数")),/^\d{6}$/.test(e.toString().replace(/\s/g,""))?a():a(new Error("请输入6位密码"))},trigger:"blur"}],numberOfSheets:[{required:!0,message:"请输入申请张数",trigger:"blur"}]},cardTypeOptions:[],current:1,size:1e3,tenantId:this.$store.state.loginUser.consumerId,cardList:[],cardTypeObject:{},cardTypeCode:""}},created:function(){this.handleCardType(),this.getCardPolicy()},methods:{handleChangeCardType:function(){this.ruleForm.cardProductId="",this.$nextTick(function(){this.$refs.ruleForm.clearValidate("cardProductId")}),this.getCardPolicy()},handleSelectCardType:function(r){var e=this;e.cardList.forEach(function(a){a.id==r&&(e.cardTypeCode=a.cardTypeCode)})},handleCancelAdd:function(){this.$store.commit("tagNav/removeTagNav",this.$route),this.$router.push({path:"/member/membershipCard/entityCardList"})},handleCardType:function(){var r={tenantId:this.$store.state.loginUser.consumerId},e=this;e.$crmList.getCardType(r).then(function(r){e.cardTypeOptions=r})},getCardPolicy:function(){var r=this,e={cardProductName:"",cardType:r.ruleForm.cardType?r.ruleForm.cardType:"stored_card",channelNo:"",checkExpire:!0,current:r.current,size:r.size,status:"start",tenantId:r.tenantId};r.$crmList.cardproductList(e).then(function(e){r.cardList=e.records,e.records.forEach(function(e){r.cardTypeObject[e.id]=e.cardName})}).catch(function(e){r.cardList=[]})},submitForm:function(r){var e=this;this.$refs[r].validate(function(r){if(!r)return console.log("error submit!!"),!1;if(e.cardTypeCode!=e.ruleForm.cardType)return e.$message.warning("所选适用政策与卡类型不一致，请重新选择"),!1;var a={cardWay:e.ruleForm.cardWay,batchCount:e.ruleForm.numberOfSheets,batchName:e.ruleForm.name,cardNoRule:"0"==e.ruleForm.cardNumberRule?"auto":"",cardType:e.ruleForm.cardType,cardProductId:e.ruleForm.cardProductId,cardProductName:e.cardTypeObject[e.ruleForm.cardProductId],passwordRule:e.ruleForm.passwordRule,password:e.ruleForm.password,tenantId:e.tenantId};return/^\+?[1-9][0-9]*$/.test(e.ruleForm.numberOfSheets)?e.ruleForm.numberOfSheets>1e4||e.ruleForm.numberOfSheets<0?(e.$message.warning("申请的卡张数范围在1-10000内！"),!1):("gift_card"!=e.cardTypeCode&&(a.passwordRule="",a.password=""),void e.$crmList.cardbatchAdd(a).then(function(r){e.$message.success("保存成功"),e.$store.commit("tagNav/removeTagNav",e.$route),e.$router.push({path:"/member/membershipCard/entityCardList"})}).catch(function(r){e.$message.error("保存失败，请重试"),console.log(r)})):(e.$message.warning("申请张数请输入非零正整数"),!1)})}}}},389:function(r,e,a){var t=a(390);"string"==typeof t&&(t=[[r.i,t,""]]),t.locals&&(r.exports=t.locals);a(132)("fbf94ce4",t,!0,{})},390:function(r,e,a){e=r.exports=a(131)(!0),e.push([r.i,"\n.add-entity-card-wrap .form-data-wrap {\n  padding: 20px;\n}\n.add-entity-card-wrap .form-data-wrap .el-form-item__error {\n    top: 40px !important;\n}\n.add-entity-card-wrap .form-data-wrap .el-form-item {\n    margin-bottom: 20px;\n}\n.add-entity-card-wrap .form-data-wrap ._member-unit-custom {\n    font-size: 14px;\n    color: #666;\n    margin-left: 8px;\n}\n.add-entity-card-wrap .form-data-wrap .el-input__inner {\n    width: 360px !important;\n    line-height: 32px !important;\n}\n.add-entity-card-wrap .form-data-wrap .el-input {\n    width: 360px !important;\n}\n.add-entity-card-wrap .form-data-wrap .btn-wrap {\n    width: 100%;\n    margin: 40px 0 40px;\n    text-align: center;\n}\n.add-entity-card-wrap .form-data-wrap .btn-wrap .el-form-item__content {\n      margin-left: 0 !important;\n}\n","",{version:3,sources:["G:/Workspaces/work/chenxin/module-hyy/crm/src/views/member/membershipCardInfo/addEntityCard.vue"],names:[],mappings:";AACA;EACE,cAAc;CACf;AACD;IACI,qBAAqB;CACxB;AACD;IACI,oBAAoB;CACvB;AACD;IACI,gBAAgB;IAChB,YAAY;IACZ,iBAAiB;CACpB;AACD;IACI,wBAAwB;IACxB,6BAA6B;CAChC;AACD;IACI,wBAAwB;CAC3B;AACD;IACI,YAAY;IACZ,oBAAoB;IACpB,mBAAmB;CACtB;AACD;MACM,0BAA0B;CAC/B",file:"addEntityCard.vue",sourcesContent:["\n.add-entity-card-wrap .form-data-wrap {\n  padding: 20px;\n}\n.add-entity-card-wrap .form-data-wrap .el-form-item__error {\n    top: 40px !important;\n}\n.add-entity-card-wrap .form-data-wrap .el-form-item {\n    margin-bottom: 20px;\n}\n.add-entity-card-wrap .form-data-wrap ._member-unit-custom {\n    font-size: 14px;\n    color: #666;\n    margin-left: 8px;\n}\n.add-entity-card-wrap .form-data-wrap .el-input__inner {\n    width: 360px !important;\n    line-height: 32px !important;\n}\n.add-entity-card-wrap .form-data-wrap .el-input {\n    width: 360px !important;\n}\n.add-entity-card-wrap .form-data-wrap .btn-wrap {\n    width: 100%;\n    margin: 40px 0 40px;\n    text-align: center;\n}\n.add-entity-card-wrap .form-data-wrap .btn-wrap .el-form-item__content {\n      margin-left: 0 !important;\n}\n"],sourceRoot:""}])},391:function(r,e,a){"use strict";var t=function(){var r=this,e=r.$createElement,a=r._self._c||e;return a("div",{staticClass:"add-entity-card-wrap"},[a("el-form",{ref:"ruleForm",staticClass:"form-data-wrap specialTab",attrs:{model:r.ruleForm,rules:r.rules,"label-width":"110px","label-position":"left"}},[a("el-form-item",{attrs:{label:"批次名：",prop:"name"}},[a("el-input",{attrs:{maxlength:"10",placeholder:"请输入实体卡批次名称"},model:{value:r.ruleForm.name,callback:function(e){r.$set(r.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),r._v(" "),a("el-form-item",{attrs:{label:"开卡方式：",prop:"cardWay"}},[a("el-radio-group",{model:{value:r.ruleForm.cardWay,callback:function(e){r.$set(r.ruleForm,"cardWay",e)},expression:"ruleForm.cardWay"}},[a("el-radio",{attrs:{label:1}},[r._v("磁条卡读卡")]),r._v(" "),a("el-radio",{attrs:{label:0}},[r._v("IC卡写卡")])],1)],1),r._v(" "),a("el-form-item",{attrs:{label:"卡类型：",prop:"cardType"}},[a("el-select",{attrs:{placeholder:"请选择卡类型",clearable:""},on:{change:r.handleChangeCardType},model:{value:r.ruleForm.cardType,callback:function(e){r.$set(r.ruleForm,"cardType",e)},expression:"ruleForm.cardType"}},r._l(r.cardTypeOptions,function(r){return a("el-option",{key:r.code,attrs:{label:r.desc,value:r.code}})}),1)],1),r._v(" "),a("el-form-item",{attrs:{label:"适用政策：",prop:"cardProductId"}},[a("el-select",{attrs:{placeholder:"请选择适用政策",filterable:"",clearable:""},on:{change:r.handleSelectCardType},model:{value:r.ruleForm.cardProductId,callback:function(e){r.$set(r.ruleForm,"cardProductId",e)},expression:"ruleForm.cardProductId"}},r._l(r.cardList,function(r){return a("el-option",{key:r.id,attrs:{label:r.cardName,value:r.id}})}),1)],1),r._v(" "),a("el-form-item",{attrs:{label:"卡号生成规则：",prop:"cardNumberRule"}},[a("el-radio-group",{model:{value:r.ruleForm.cardNumberRule,callback:function(e){r.$set(r.ruleForm,"cardNumberRule",e)},expression:"ruleForm.cardNumberRule"}},[a("el-radio",{attrs:{label:"0"}},[r._v("随机卡号")]),r._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"卡号不能为7位或11位，只支持数字或字母",placement:"right"}}),r._v(" "),"1"==r.ruleForm.cardNumberRule?a("el-input",{staticStyle:{marginLeft:"30px"},attrs:{placeholder:"请输入自定义卡号"}}):r._e()],1)],1),r._v(" "),"gift_card"==r.cardTypeCode?a("el-form-item",{attrs:{label:"卡密码规则：",prop:"passwordRule"}},[a("el-radio-group",{model:{value:r.ruleForm.passwordRule,callback:function(e){r.$set(r.ruleForm,"passwordRule",e)},expression:"ruleForm.passwordRule"}},[a("el-radio",{attrs:{label:1}},[r._v("随机密码")]),r._v(" "),a("el-radio",{attrs:{label:0}},[r._v("统一设置密码")])],1)],1):r._e(),r._v(" "),"gift_card"==r.cardTypeCode&&0==r.ruleForm.passwordRule?a("el-form-item",{attrs:{label:"统一密码：",prop:"password"}},[a("el-input",{attrs:{placeholder:"请输入6位密码"},model:{value:r.ruleForm.password,callback:function(e){r.$set(r.ruleForm,"password",e)},expression:"ruleForm.password"}})],1):r._e(),r._v(" "),a("el-form-item",{attrs:{label:"申请张数：",prop:"numberOfSheets"}},[a("el-input",{model:{value:r.ruleForm.numberOfSheets,callback:function(e){r.$set(r.ruleForm,"numberOfSheets",e)},expression:"ruleForm.numberOfSheets"}}),a("span",{staticClass:"_member-unit-custom"},[r._v("张")])],1),r._v(" "),a("el-form-item",{staticClass:"btn-wrap"},[a("el-button",{staticClass:"_el-btn-custom _member-add-edit-save-btn",attrs:{type:"primary"},on:{click:function(e){return r.submitForm("ruleForm")}}},[r._v("保存\n      ")]),r._v(" "),a("el-button",{staticClass:"_el-btn-custom",on:{click:r.handleCancelAdd}},[r._v("取消")])],1)],1)],1)},n=[],o={render:t,staticRenderFns:n};e.a=o}});