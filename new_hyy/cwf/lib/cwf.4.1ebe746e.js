webpackJsonpcwf([4],{106:function(t,e,n){var i=n(107);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n(51)("24a77633",i,!0,{})},107:function(t,e,n){e=t.exports=n(50)(!0),e.push([t.i,"\n.cwf_editBillSetting .detail[data-v-c1d054c6] {\n  width: 100%;\n  overflow: hidden;\n  margin-bottom: 60px;\n}\n.cwf_editBillSetting .detail .box[data-v-c1d054c6] {\n    margin-bottom: 24px;\n    min-height: 600px;\n    float: left;\n}\n.cwf_editBillSetting .detail .box .box-item[data-v-c1d054c6] {\n      margin-bottom: 24px;\n}\n.cwf_editBillSetting .detail .box .box-item .item-title[data-v-c1d054c6] {\n        font-size: 12px;\n        width: 150px;\n        line-height: 32px;\n        height: 32px;\n        text-align: left;\n        padding-right: 5px;\n        color: #666666;\n}\n.cwf_editBillSetting .detail .cinema-item[data-v-c1d054c6] {\n    min-width: 284px;\n    float: left;\n    height: 770px;\n    overflow-y: scroll;\n    overflow-x: hidden;\n    font-size: 12px;\n    background: #f5f5f5;\n    margin-right: 20px;\n    padding-top: 10px;\n}\n.cwf_editBillSetting .detail .cinema-item .el-tree[data-v-c1d054c6] {\n      margin-top: 10px;\n}\n.cwf_editBillSetting .footer[data-v-c1d054c6] {\n  position: fixed;\n  bottom: 0px;\n  height: 70px;\n  line-height: 70px;\n  width: 90%;\n  background: #ffffff;\n  text-align: center;\n}\n.cwf_editBillSetting .footer .el-button[data-v-c1d054c6] {\n    width: 80px;\n    height: 32px;\n    text-align: center;\n    vertical-align: middle;\n    padding: 0;\n    margin: 0;\n    line-height: 32px;\n    margin-right: 32px;\n}\n","",{version:3,sources:["G:/Workspaces/work/chenxin/module-hyy/cwf/src/views/workflow/billSetting/editBillSetting.vue"],names:[],mappings:";AACA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;CACrB;AACD;IACI,oBAAoB;IACpB,kBAAkB;IAClB,YAAY;CACf;AACD;MACM,oBAAoB;CACzB;AACD;QACQ,gBAAgB;QAChB,aAAa;QACb,kBAAkB;QAClB,aAAa;QACb,iBAAiB;QACjB,mBAAmB;QACnB,eAAe;CACtB;AACD;IACI,iBAAiB;IACjB,YAAY;IACZ,cAAc;IACd,mBAAmB;IACnB,mBAAmB;IACnB,gBAAgB;IAChB,oBAAoB;IACpB,mBAAmB;IACnB,kBAAkB;CACrB;AACD;MACM,iBAAiB;CACtB;AACD;EACE,gBAAgB;EAChB,YAAY;EACZ,aAAa;EACb,kBAAkB;EAClB,WAAW;EACX,oBAAoB;EACpB,mBAAmB;CACpB;AACD;IACI,YAAY;IACZ,aAAa;IACb,mBAAmB;IACnB,uBAAuB;IACvB,WAAW;IACX,UAAU;IACV,kBAAkB;IAClB,mBAAmB;CACtB",file:"editBillSetting.vue",sourcesContent:["\n.cwf_editBillSetting .detail[data-v-c1d054c6] {\n  width: 100%;\n  overflow: hidden;\n  margin-bottom: 60px;\n}\n.cwf_editBillSetting .detail .box[data-v-c1d054c6] {\n    margin-bottom: 24px;\n    min-height: 600px;\n    float: left;\n}\n.cwf_editBillSetting .detail .box .box-item[data-v-c1d054c6] {\n      margin-bottom: 24px;\n}\n.cwf_editBillSetting .detail .box .box-item .item-title[data-v-c1d054c6] {\n        font-size: 12px;\n        width: 150px;\n        line-height: 32px;\n        height: 32px;\n        text-align: left;\n        padding-right: 5px;\n        color: #666666;\n}\n.cwf_editBillSetting .detail .cinema-item[data-v-c1d054c6] {\n    min-width: 284px;\n    float: left;\n    height: 770px;\n    overflow-y: scroll;\n    overflow-x: hidden;\n    font-size: 12px;\n    background: #f5f5f5;\n    margin-right: 20px;\n    padding-top: 10px;\n}\n.cwf_editBillSetting .detail .cinema-item .el-tree[data-v-c1d054c6] {\n      margin-top: 10px;\n}\n.cwf_editBillSetting .footer[data-v-c1d054c6] {\n  position: fixed;\n  bottom: 0px;\n  height: 70px;\n  line-height: 70px;\n  width: 90%;\n  background: #ffffff;\n  text-align: center;\n}\n.cwf_editBillSetting .footer .el-button[data-v-c1d054c6] {\n    width: 80px;\n    height: 32px;\n    text-align: center;\n    vertical-align: middle;\n    padding: 0;\n    margin: 0;\n    line-height: 32px;\n    margin-right: 32px;\n}\n"],sourceRoot:""}])},108:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cwf_editBillSetting"},[n("div",{staticClass:"detail"},[n("el-row",[n("el-col",{attrs:{span:6}},[n("div",{staticClass:"cinema-item"},[t._v("\n            指定组织：\n          "),n("el-tree",{ref:"tree",attrs:{data:t.treeArr,"show-checkbox":"","default-expand-all":"","node-key":"id","highlight-current":"",props:t.defaultProps,"check-strictly":!1,"default-checked-keys":t.defaultCheckedKeys}})],1)]),t._v(" "),n("el-col",{attrs:{span:18}},[n("div",{staticClass:"box"},[n("el-row",{attrs:{gutter:20}},t._l(t.resetRenderData,function(e){return n("el-col",{key:e.id,staticClass:"box-item",attrs:{span:12}},[t.resetRenderData.length?[n("div",[n("div",{staticStyle:{float:"left"}},[n("div",{staticClass:"item-title"},[t._v(t._s(e.businessName)+"：")])]),t._v(" "),n("div",{staticStyle:{float:"left"}},[t.optionsValue?n("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.change()}},model:{value:t.optionsValue[""+e.businessNo],callback:function(n){t.$set(t.optionsValue,""+e.businessNo,n)},expression:"optionsValue[`${item.businessNo}`]"}},t._l(e.list,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e()],1)])]:t._e()],2)}),1)],1)])],1)],1),t._v(" "),n("div",{staticClass:"footer"},["add"==t.type?n("el-button",{staticClass:"footerBtn",attrs:{type:"primary"},on:{click:t.addPersonalSetting}},[t._v("确 定")]):t._e(),t._v(" "),"edit"==t.type?n("el-button",{staticClass:"footerBtn",attrs:{type:"primary"},on:{click:t.editPersonalSetting}},[t._v("确 定")]):t._e(),t._v(" "),n("el-button",{staticClass:"footerBtn",on:{click:t.closeBack}},[t._v("取 消")])],1)])},a=[],o={render:i,staticRenderFns:a};e.a=o},58:function(t,e,n){"use strict";function i(t){n(106)}Object.defineProperty(e,"__esModule",{value:!0});var a=n(75),o=n(108),s=n(12),r=i,d=s(a.a,o.a,!1,r,"data-v-c1d054c6",null);e.default=d.exports},59:function(t,e,n){t.exports={default:n(61),__esModule:!0}},61:function(t,e,n){var i=n(1),a=i.JSON||(i.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}},75:function(t,e,n){"use strict";var i=n(59),a=n.n(i);e.a={data:function(){return{dataInfo:{},type:this.$route.query.type||"",businessId:this.$route.query.businessId||"",tenantId:this.$store.state.loginUser.consumerId||"",userUid:this.$store.state.loginUser.uid||"",defaultProps:{children:"subtree",label:"menuName"},treeData:{},treeArr:[],defaultCheckedKeys:[],tableData:[],resetRenderData:[],options:[],optionsValue:{}}},created:function(){this.showpageType(),this.getBillNormalSetting()},methods:{showpageType:function(){"add"==this.type&&this.querySetHistory(),"edit"==this.type&&this.findSetUpById()},findSetUpById:function(){var t=this,e={businessId:this.businessId};this.$cwfList.findSetUpById(e).then(function(e){e&&200===e.code?(t.dataInfo=e.data,t.querySetHistory()):t.$message({message:e.msg,type:"warning",duration:1e3})}).catch(function(t){console.log(t)})},showTreeData:function(t){var e=this,n={userUid:this.userUid};this.$cwfList.getOrgTreeAndCinema(n).then(function(n){n&&200===n.code?(e.treeData=n.data,"edit"==e.type&&(e.editInitTreeData(),e.resetTreeData(e.treeData,t)),"add"==e.type&&e.resetTreeData(e.treeData,t),e.treeArr.push(e.treeData),console.log("treeArr",e.treeArr),e.type):e.$message({message:n.msg,type:"warning",duration:1e3})}).catch(function(t){console.log(t)})},getBillNormalSetting:function(){var t=this,e={global:1,orginizationId:0,tenantId:this.tenantId};this.$cwfList.getBillNormalSetting(e).then(function(e){e&&200===e.code?(t.tableData=e.data.businessTypeList,t.options=e.data.workflowList,t.resetDataNormalSetting(),"edit"==t.type&&t.editInitNormalSettingData()):t.$message({message:e.msg,type:"warning",duration:1e3})}).catch(function(t){console.log(t)})},querySetHistory:function(){var t=this,e={};this.$cwfList.querySetHistory(e).then(function(e){if(e&&200===e.code&&1==e.flag){if("add"==t.type){var n=e.data||[];t.showTreeData(n)}if("edit"==t.type){var i=e.data||[],a=[];if(t.dataInfo.merchantId&&(a=t.dataInfo.merchantId.split(",")),0!=a.length)for(var o=0;o<a.length;o++)for(var s=i.length-1;s>=0;s--)if(i[s]==a[o]){console.log(i[s]+"--------"+a[o]),i.splice(s,1);break}console.log("editList",i),t.showTreeData(i)}}else t.$message({message:e.msg,type:"warning",duration:1e3})}).catch(function(t){console.log(t)})},editInitTreeData:function(){var t=this;setTimeout(function(){t.defaultCheckedKeys=t.dataInfo.merchantId.split(","),console.log(t.defaultCheckedKeys),t.$refs.tree.setCheckedKeys(t.defaultCheckedKeys)},100)},resetTreeData:function(t,e){var n=this;if(t.subtree){if(t.cinemaInfos)for(var i=0;i<t.cinemaInfos.length;i++){var a=t.cinemaInfos[i],o={id:a.id,menuName:a.name,subtree:[]};t.subtree.push(o)}for(var s=0;s<t.subtree.length;s++)!function(i){var a=t.subtree[i];e.forEach(function(t){a.id==t&&(a.disabled=!0)}),a.subtree&&n.resetTreeData(a,e)}(s)}},editResetTreeData:function(t,e){var n=this;if(t.subtree){if(t.cinemaInfos)for(var i=0;i<t.cinemaInfos.length;i++){var a=t.cinemaInfos[i],o={id:a.id,menuName:a.name,subtree:[]};t.subtree.push(o)}for(var s=0;s<t.subtree.length;s++)!function(i){var a=t.subtree[i];e.forEach(function(t){a.id==t&&(a.disabled=!0)}),a.subtree&&n.editResetTreeData(a,e)}(s)}},getCheckedNodes:function(){console.log(this.$refs.tree.getCheckedNodes())},resetDataNormalSetting:function(){var t=this;this.resetRenderData=JSON.parse(a()(this.tableData));var e=!1;this.resetRenderData.forEach(function(e){e.list=JSON.parse(a()(t.options))}),this.options.forEach(function(t){2==t.id&&(e=!0)}),e?this.resetRenderData.forEach(function(e){t.optionsValue[""+e.businessNo]="2"}):this.resetRenderData.forEach(function(e){t.optionsValue[""+e.businessNo]=""}),console.log(this.resetRenderData),console.log(this.optionsValue)},editInitNormalSettingData:function(){var t=this;console.log("this.options",this.options),this.options.forEach(function(e){t.dataInfo.rlsList.forEach(function(n){n.workflowBusinessId==e.id&&(t.optionsValue[""+n.businessTypeCode]=e.id)})}),console.log("getCheckedNodes",this.$refs.tree.getCheckedNodes())},closeBack:function(){this.$store.commit("tagNav/removeTagNav",this.$route),this.$router.push({path:"/workflow/billSetting",query:{page:"second"}})},change:function(){this.$forceUpdate()},addPersonalSetting:function(){var t=this,e={orginizationId:"",orginizationName:""},n=this.$refs.tree.getCheckedNodes();if(n.forEach(function(t){console.log("items---",t),t.uid||(e.orginizationId?e.orginizationId+=","+t.id:e.orginizationId=t.id,e.orginizationName?e.orginizationName+=","+t.menuName:e.orginizationName=t.menuName)}),console.log("treeArray",n),""==e.orginizationId)return void this.$message({message:"组织下的影院不能为空",type:"warning",duration:1500});console.log("tree",e);var i={tenantId:this.tenantId,list:[]};if(this.resetRenderData.forEach(function(n){parseInt(t.optionsValue[""+n.businessNo])&&i.list.push({businessTypeCode:n.businessNo,global:1,orginizationId:e.orginizationId,orginizationName:e.orginizationName,tenantId:t.tenantId,workflowBusinessId:t.optionsValue[""+n.businessNo]})}),0==i.list.length)return void this.$message({message:"请选择审批流程选项",type:"warning",duration:1e3});console.log(a()(i)),this.$cwfList.addPersonalSetting(i).then(function(e){e&&200===e.code&&1==e.flag?(t.$message({message:"新增成功",type:"success",duration:1e3}),t.closeBack()):t.$message({message:e.msg,type:"warning",duration:1e3})}).catch(function(t){console.log(t)})},editPersonalSetting:function(){var t=this,e={orginizationId:"",orginizationName:""};if(this.$refs.tree.getCheckedNodes().forEach(function(t){console.log("items---",t),t.uid||(e.orginizationId?e.orginizationId+=","+t.id:e.orginizationId=t.id,e.orginizationName?e.orginizationName+=","+t.menuName:e.orginizationName=t.menuName)}),""==e.orginizationId)return void this.$message({message:"组织下的影院不能为空",type:"warning",duration:1500});var n={tenantId:this.tenantId,merchantId:this.dataInfo.merchantId,list:[]};if(this.resetRenderData.forEach(function(i){parseInt(t.optionsValue[""+i.businessNo])&&n.list.push({businessTypeCode:i.businessNo,orginizationId:e.orginizationId,orginizationName:e.orginizationName,tenantId:t.tenantId,workflowBusinessId:t.optionsValue[""+i.businessNo]+""})}),0==n.list.length)return void this.$message({message:"请选择审批流程选项",type:"warning",duration:1e3});console.log(a()(n)),this.$cwfList.editBillSetting(n).then(function(e){e&&200===e.code&&1==e.flag?(t.$message({message:"编辑成功",type:"success",duration:1e3}),t.closeBack()):t.$message({message:e.msg,type:"warning",duration:1e3})}).catch(function(t){console.log(t)})}}}}});